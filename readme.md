# Скарапер рецептов с Calorizator
Скрапер стаскивает рецепты с https://calorizator.ru и сохраняет их в JSON-файл для последующей заливки в Django через `manage.py loaddata`. Картики сохраняются локально в `./media/recipes`.

## Установка
Через Poetry:

```sh
poetry install
```

## Запуск скрапера
Скрапер полезет на https://calorizator.ru и скачает блюда из категорий, ссылки на которые указаны в скрипте. Данные для запуска через Джанговский `loaddata` сохраняться в `dump.json`, картинки — в папку `media/`.

```sh
make run
# или
poetry run python main.py
```

## Заливка на сервер
Сейчас проще всего запустить парсер локально, скопировать на сервер `dump.json` и `media/`. Можно улучшить, добавив возможность указывать, куда сохранять файлы, чтобы можно было запускать на сервере и чтобы сразу файлы сохранялись в удобное место.

Запускать в текущей директории на локальной машине и ввести пароль для `tgbot`:

```sh
# скопировать данные для загрузки в Джангу
rsync ./dump.json tgbot@94.103.94.142:/home/tgbot/projects/foodplan_admin/

# скопировать скачанные картинки
rsync -av ./media tgbot@94.103.94.142:/home/tgbot/projects/foodplan_admin/
```

Далее на сервере:

```sh
cd /home/tgbot/projects/foodplan_admin/
poetry run python manage.py loaddata dump.json
```

Если что-то пойдёт не так, можно удалить в админке все ингредиенты, рецепты и предпочтения и запустить `loaddata` заново.
